<!DOCTYPE html>
<title>EmojiGen</title>
<meta charset="utf-8" />

<h1>Here is the latest emoji data:</h1>
<p>
  Grab the text from <a href="http://www.unicode.org/Public/emoji/latest/emoji-test.txt">http://www.unicode.org/Public/emoji/latest/emoji-test.txt</a> and paste it here.
  It will take a while to run.
  Requires JavaScript obvs.
</p>
<textarea id="text-goes-here"></textarea>

<pre id="data-goes-here" style="white-space:pre-wrap"></pre>

<script>
  document.getElementById("text-goes-here").addEventListener("change", process);

  function process (e) {
    var data = [];
    var lines = e.target.value.split('\n');
    var subgroup = 'other';
    var subdata = [];
    for (var i = 0; i < lines.length; i++) {
      var line = lines[i];
      var match;
      if (/^#(?! subgroup: )/.test(line)) continue;
      if (match = /^# subgroup: (.*\S)/.exec(line)) {
        if (subdata.length) {
          data.push('\'' + subgroup + '\': [\n    ' + subdata.join(',\n    ') + ',\n  ]');
        }
        subgroup = match[1].replace(/\s/g, '_');
        subdata = [];
        continue;
      }
      if (match = /^\s*((?:[0-9A-Fa-f]+\s*)+);\s*fully-qualified\s*(?:$|#)/.exec(line)) {
        subdata.push('[' + match[1].split(/\s+(?=[0-9A-Fa-f])/g).map(function (num) {
          return '0x' + num.trim();
        }).join(', ') + ']');
      }
    }
    if (subdata.length) {
      data.push('\'' + subgroup + '\': [\n    ' + subdata.join(',\n    ') + ',  \n]');
    }
    document.getElementById("data-goes-here").textContent = '{\n  ' + data.join(',\n  ') + ',\n}';
  }
</script>
